$(document).ready(function() {
    $("#phoneMask").inputmask("+7 (999) 999-99-99");
    $('.j-need-tooltip').tooltipster({
        positionTracker: true,
        trigger: "hover",
        content: $('.j-b-tooltip-discount-content').html(),
        contentAsHTML: true,
        trigger: "hover",
        theme: 'tooltipster-shadow',
        position: 'bottom'
    });
    $('.basket-delivery-methods .tab').click(function(){
		var tab_id = $(this).attr('data-t');
		var price = parseInt($(this).attr('data-price'));
		var itemPrice = parseInt($('#itemPrice').val());

        if(tab_id == 'courier') {
            $('#orderDetails_NewAddress').attr('required', '');
        } else {
            $('#orderDetails_NewAddress').removeAttr('required');
        }

		$('.basket-delivery-methods .tab').removeClass('active');
		$('.tab-content').removeClass('active');
		$('.j-b-basket-footer .baskdeltype').addClass('hide');

		$(this).addClass('active');
		$('.tab-content.c-'+tab_id).addClass('active');
		$('.j-b-basket-footer .c-'+tab_id).removeClass('hide');

        $('#delPrice').val(price);
        $('#delType').val(tab_id);
        $('#amount').val(itemPrice+price);
        $('#showTotal').html(new Intl.NumberFormat('ru-RU').format(itemPrice+price) + ' â‚½');
	});
    
    $('form').find('select, textarea, input').on('focus, blur, input, onkeyup, change', function() {
        if($(this).prop('required')) {
            if (!$(this).val()) {
                $(this).css({'border' : '1px solid #cb11ab'});
                $(this).parent().parent().find('.mess-input').removeClass('hide');
            } else {
                $(this).removeAttr('style');
                $(this).parent().parent().find('.mess-input').addClass('hide');
            }
        }
    });
    
    $('.j-btn-confirm-order').on('click', (e) => {
        e.preventDefault();
        var fail = false;
        $('form').find('select, textarea, input').each(function() {
            if($(this).prop('required')) {
                if (!$(this).val()) {
                    $(this).css({'border' : '1px solid #cb11ab'});
                    $(this).parent().parent().find('.mess-input').removeClass('hide');
                    fail = true;
                } else {
                    $(this).removeAttr('style');
                    $(this).parent().parent().find('.mess-input').addClass('hide');
                }
            }
        });

        if (!fail) {
            $("#basketForm").submit();
        }
    });
});