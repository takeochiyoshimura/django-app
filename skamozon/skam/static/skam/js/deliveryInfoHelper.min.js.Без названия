(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";function asyncGeneratorStep(e,t,r,i,n,s,o){try{var d=e[s](o),a=d.value}catch(e){return void r(e)}d.done?t(a):Promise.resolve(a).then(i,n)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise(function(i,n){var s=e.apply(t,r);function o(e){asyncGeneratorStep(s,i,n,o,d,"next",e)}function d(e){asyncGeneratorStep(s,i,n,o,d,"throw",e)}o(void 0)})}}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}!function(){var e=function(){function e(e,t){this.parentId=e,this.nmId=t.nmId,this.nmSizes=t.sizes,this.enabledForRegion=t.enabledForRegion,this.allSizesSoldOut=t.allSizesSoldOut,this.selectedSize=t.selectedSize,this.deliveryHours=t.deliveryHours,this.fastestStore=t.fastestStore,this.isImport=t.isImport,this.onSizeUpdated=this.onSizeUpdated.bind(this),this.onColorChanged=this.onColorChanged.bind(this)}var t=e.prototype;return t.init=function(){return this._bindEvents(),this},t.destroy=function(){return this._unbindEvents(),this},t.onSizeUpdated=function(e){var t=e.detail,r=t.nmId,i=t.selectedSize;this.nmId==r&&this.updateSize(i)},t.onColorChanged=function(e){var t=e.detail,r=t.sourceId,i=t.sourceNmId,n=t.selectedNomenclature;r==this.parentId&&i==this.nmId&&($.observable(this).setProperty({nmId:n.nmId,enabledForRegion:n.enabledForRegion,allSizesSoldOut:n.allSizesSoldOut,selectedSize:n.selectedSize,deliveryHours:n.deliveryHours,fastestStore:n.fastestStore,isImport:n.isImport}),this.nmSizes=n.sizes,this.updateAll())},t.updateAll=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.updateSize(null===(t=this.selectedSize)||void 0===t?void 0:t.characteristicId);case 2:this._updateProductFlags(),this.updateExpressStore();case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),t.updateSize=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,i,n,s,o,d;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=null,this.deliveryModelTask=new this.$helper.Deferred,!this.enabledForRegion||this.allSizesSoldOut||null!==(r=this.selectedSize)&&void 0!==r&&r.isSoldOut){e.next=13;break}return e.next=5,this.$moduleLoader.loadServiceAsync("deliveryInfoService");case 5:return e.next=7,this.$services.deliveryInfoService.getDeliveryInfoAsync(t);case 7:n=e.sent,this.deliveryInfo=n,s=this._getStoresForSize(t),o=this._getFastestStoreFromProduct(t),d=this._getDeliveryDateFromProduct(t),i=this.$services.deliveryInfoService.getDeliveryModel(n,s,o,d,null,this.isImport);case 13:this.deliveryModelTask.resolve(i),$.observable(this).setProperty({deliveryInfoModel:i});case 15:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),t._updateProductFlags=function(){var e,t,r,i=this;null!==(e=this.deliveryInfo)&&void 0!==e&&e.delivery&&this.deliveryInfoModel&&$.observable(this.deliveryInfoModel).setProperty({isComputedDeliveryCost:null===(t=this.nmSizes)||void 0===t?void 0:t.some(function(e){var t;return null===(t=e.storeIds)||void 0===t?void 0:t.some(function(e){return i.deliveryInfo.delivery.stores.computedDelCostStores.includes(e)})}),isCargo:null===(r=this.nmSizes)||void 0===r?void 0:r.some(function(e){var t;return null===(t=e.storeIds)||void 0===t?void 0:t.some(function(e){return i.deliveryInfo.delivery.stores.cargo.includes(e)})})})},t.updateExpressStore=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$moduleLoader.loadServiceAsync("deliveryInfoService");case 2:return e.next=4,this.$services.deliveryInfoService.getExpressStoreAsync();case 4:r=e.sent,Object.values(null!==(t=this.nmSizes)&&void 0!==t?t:[]).forEach(function(e){var t,i;$.observable(e).setProperty({isExpressDelivery:null!==(t=null==e?void 0:null===(i=e.storeIds)||void 0===i?void 0:i.some(function(e){return r.store==e}))&&void 0!==t&&t})});case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),t.getByChrtId=function(e){var t=this._getStoresForSize(e),r=this._getFastestStoreFromProduct(e),i=this._getDeliveryDateFromProduct(e);return this.$services.deliveryInfoService.getDeliveryModel(this.deliveryInfo,t,r,i,null,this.isImport)},t._bindEvents=function(){this.$eventBus.addEventListener("ProductSizeUpdated",this.onSizeUpdated),this.$eventBus.addEventListener("ProductColorChanged",this.onColorChanged),this.$eventBus.addEventListener("ProductChanged",this.onColorChanged)},t._unbindEvents=function(){this.$eventBus.removeEventListener("ProductSizeUpdated",this.onSizeUpdated),this.$eventBus.removeEventListener("ProductColorChanged",this.onColorChanged),this.$eventBus.removeEventListener("ProductChanged",this.onColorChanged)},t._getStoresForSize=function(e){return e?this.nmSizes.slice().find(function(t){return t.characteristicId===e}).storeIds:Object.keys(this.nmSizes.slice().reduce(function(e,t){return t.isSoldOut||t.storeIds.forEach(function(t){return e[t]=!0}),e},{}))},t._getDeliveryDateFromProduct=function(e){var t;if(null!==(t=wb.global.settings.switches)&&void 0!==t&&t.catalogShowDeliveryDate)return e?this.nmSizes.slice().find(function(t){return t.characteristicId===e}).deliveryHours:this.deliveryHours},t._getFastestStoreFromProduct=function(e){return e?this.nmSizes.slice().find(function(t){return t.characteristicId===e}).fastestStore:this.fastestStore},_createClass(e,[{key:"template",get:function(){return e.template}}]),e}();window.__spaModuleManager__.register("deliveryInfoHelper",e)}();

},{}]},{},[1]);
