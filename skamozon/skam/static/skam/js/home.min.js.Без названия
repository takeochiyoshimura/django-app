(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";function asyncGeneratorStep(e,t,n,r,a,o,s){try{var i=e[o](s),d=i.value}catch(e){return void n(e)}i.done?t(d):Promise.resolve(d).then(r,a)}function _asyncToGenerator(e){return function(){var t=this,n=arguments;return new Promise(function(r,a){var o=e.apply(t,n);function s(e){asyncGeneratorStep(o,r,a,s,i,"next",e)}function i(e){asyncGeneratorStep(o,r,a,s,i,"throw",e)}s(void 0)})}}!function(){var e=require("../modules/home/homeRecommendationsLoader"),t=[{name:"hits",targetUrl:"MI",sizeForDynamicGoods:49,sizeForStaticGood:70,dataUrl:"/homeRecommendedGoods",analiticsCode:"MCS"},{name:"visited",targetUrl:"RG",sizeForDynamicGoods:49,sizeForStaticGood:14,dataUrl:"/webapi/goods/visited-nm",analiticsCode:"MCV"}],n=[{blockType:0,data:[],chunk:4,start:1,rows:3,bannerType:"sm",analiticsCode:"MBT"},{blockType:1,data:{showTitle:!0,rowLength:7,startCardIndex:0,rowsCount:1,blockName:"hits",advertCount:1,advertPositions:[2],advIndex:0},analiticsCode:"MCS"},{blockType:0,data:[],chunk:4,start:4,rows:2,bannerType:"sm",analiticsCode:"MBG"},{blockType:1,data:{rowLength:7,startCardIndex:7,rowsCount:1,blockName:"hits",advertCount:1,advertPositions:[3],advIndex:1},analiticsCode:"MCS"},{blockType:0,data:[],chunk:2,start:1,rows:1,bannerType:"st",analiticsCode:"MBH"},{blockType:1,data:{rowLength:7,startCardIndex:14,rowsCount:2,blockName:"hits",advertCount:2,advertPositions:[1,4],advIndex:2},analiticsCode:"MCS"},{blockType:0,data:[],chunk:2,start:2,rows:1,bannerType:"st",analiticsCode:"MBH"},{blockType:3,analticsCode:""},{blockType:1,data:{rowLength:7,startCardIndex:28,rowsCount:1,blockName:"hits",advertCount:1,advertBoundaries:[1,2],advIndex:4},analiticsCode:"MCS"},{blockType:0,data:[],chunk:2,start:3,rows:1,bannerType:"st",analiticsCode:"MBH"},{blockType:1,data:{rowLength:7,startCardIndex:35,rowsCount:5,blockName:"hits",enableShowMoreBtn:!0,advertCount:5,advertBoundaries:[1,2],advIndex:5},analiticsCode:"MCS"},{blockType:1,data:{showTitle:!0,rowLength:7,startCardIndex:0,rowsCount:2,blockName:"visited",enableShowMoreBtn:!0},analiticsCode:"MCV"}],r=function(){function r(r){var a=this;this.blocks=n,this._setBanners(r.bannersTask,r.banners),this.recommendationsLoaders=t.reduce(function(t,n){return t.set(n.name,e.create(n)),t},new Map),this.blocks.forEach(function(e){if(1==e.blockType){var t=a.recommendationsLoaders.get(e.data.blockName);e.data.id=btoa(a.$generateGuid()),t.addBlock(e.data)}}),this.canShowStories=wb.global.settings.switches.showWbStoriesOnMainPage,this.bottomTextOpened=!1,this.topBrandsContainer=null,this.lazyLoader=null,this.brandsLoader=null,this.updateLazyLoaderEvent=this._updateLazyLoader.bind(this,null),this.initTopBrands=this.initTopBrands.bind(this),this.loadStories=this.loadStories.bind(this),this._onChangeDisplayMode=this._onChangeDisplayMode.bind(this)}var a=r.prototype;return a.onBeforeRender=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:$.observe(wb.settings,"displayMode",this._onChangeDisplayMode);case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),a._onChangeDisplayMode=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$services.bannersService.getBannersForHomePageAsync();case 2:t=e.sent,$.observable(this).setProperty({mainBanners:t.mainBanners});case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),a.onAfterRender=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,n=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return document.addEventListener("DynamicCarouselRendered",this.updateLazyLoaderEvent),this.recommendationsLoaders.forEach(function(e){return e.init()}),this.topBrandsContainer=document.querySelector(".j-brands-slider-wrapper"),t=this.$moduleLoader.loadModuleAsync("lazyImageLoader").then(function(e){return n.lazyLoader=new e(document.documentElement),Promise.resolve()}),this.promoBanners=this._initPromoBanner(),this._initSeo(),this.$stat.banners.sendStatisticNow(),this.$stat.banners.initClickEvent(),this.quickNavDestroyer=wb.quickNav({bottomPx:document.documentElement.clientHeight}),e.next=11,Promise.all([t,this.recommendationsLazyLoader(t)]);case 11:this._updateLazyLoader();case 12:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),a.getScreenName=function(){return"Main"},a.onBeforeUnrender=function(){var e,t,n,r,a,o;$.unobserve(wb.settings,"displayMode",this._onChangeDisplayMode),document.removeEventListener("DynamicCarouselRendered",this.updateLazyLoaderEvent),null===(e=this.quickNavDestroyer)||void 0===e||e.call(this),null===(t=this.lazyLoader)||void 0===t||t.destroy(),null===(n=this.promoBanners)||void 0===n||n.destroy(),null===(r=this.stories)||void 0===r||r.destroy(),this.$stat.banners.destroyClickEvent(),this.recommendationsLoaders.forEach(function(e){e.destroy()}),null===(a=this.recommendationsObserver)||void 0===a||a.destroy(),null===(o=this.verticalObserver)||void 0===o||o.destroy()},a.onHistoryChange=function(){this._initSeo()},a.renderCarousel=function(e){var t=$.view(e.currentTarget).data;if(t){var n=this.recommendationsLoaders.get(t.data.blockName);n&&n.renderCarousel(t.data.id)}},a.recommendationsLazyLoader=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=document.querySelectorAll(".j-goods-wrapper"),!(navigator.userAgent.indexOf("MSIE ")>0||navigator.userAgent.indexOf("Trident/")>0)){e.next=5;break}return e.next=4,t;case 4:return e.abrupt("return",n.forEach(function(e){return e.dispatchEvent(new CustomEvent("elementInViewportEvent",{bubbles:!0}))}));case 5:this.recommendationsObserver=this.$observerHelper.getVerticalObserver(n.toArray(),{}),this.recommendationsObserver.observe();case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),a.showProductCardPopup=function(e){var t=e.currentTarget,n=$.view(t).data,r=t.closest(".j-goods-wrapper").dataset,a=r.analiticsCode,o=r.start,s=t.dataset.popupNmId,i=t.dataset.targetUrl,d=parseInt(t.dataset.index)+parseInt(o);if(a=n.isAdv?"MAB":a){var c,u,l={l:a,iid:(isNaN(d)?0:d)+1};if(n.isAdv)l.t="",l.t1=null!==(c=n.advertId)&&void 0!==c?c:-1,l.t2=null!==(u=n.cpm)&&void 0!==u?u:-1,l.t3="";this.$analitic.saveState(l)}if(null!=e.target.closest(".j-open-product-popup")){e.preventDefault(),e.stopPropagation();var h=document.querySelectorAll(".j-product-item").toArray();this.$adult.proceedIfAdultConfirmed(n.adult,this.$productCardPopup.showSlider,this.$productCardPopup,{cod1S:s,newTargetUrl:i},h,h.findIndex(function(e){return e==t}))}},a.initTopBrands=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$moduleLoader.loadModuleAsync("topBrands");case 2:return t=e.sent,e.next=5,new t(this.topBrandsContainer).show();case 5:this._updateLazyLoader(this.topBrandsContainer);case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),a.loadStories=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.$user.getUserInfo();case 2:if(!e.sent.isAuth){e.next=9;break}return e.next=6,this.$moduleLoader.loadModuleAsync("wbStories");case 6:t=e.sent,this.stories=new t(t.template),this.stories.init();case 9:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),a._setBanners=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t,n){var r,a=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r=!n)){e.next=5;break}return e.next=4,t;case 4:n=e.sent;case 5:if($.observable(this).setProperty({mainBanners:n.mainBanners}),this.blocks.forEach(function(e){var t,r;0==e.blockType&&("sm"===e.bannerType&&null!==(t=n.smallBanners)&&void 0!==t&&t.length&&$.observable(e).setProperty({data:a._buildBannerRows(n.smallBanners,e.chunk,e.start,e.rows)}),"st"===e.bannerType&&null!==(r=n.stripBanners)&&void 0!==r&&r.length&&$.observable(e).setProperty({data:a._buildBannerRows(n.stripBanners,e.chunk,e.start,e.rows)}))}),r){e.next=9;break}return e.abrupt("return");case 9:this._updateLazyLoader(),this._bannersShownStat();case 11:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}(),a._initSeo=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(t=this.seoData)||void 0===t){e.next=4;break}e.t0=t,e.next=7;break;case 4:return e.next=6,this.$httpClient.fetchJSON("/webapi/api/home/seo");case 6:e.t0=e.sent;case 7:this.seoData=e.t0,this.$seoHelper.render(this.seoData.metaTags),this.$setActionPayRetargetingModel(this.seoData.actionPayRetargetingModel),this.$setGoogleTagsModel(this.seoData.googleTagParamsModel),this.$observable.setProperty({bottomText:this.seoData.bottomText});case 12:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),a._bannersShownStat=function(){this.verticalObserver=this.$stat.banners.bannerBlockShownStatWba(this)},a._initPromoBanner=function(){var e=[],t=function(){if(window.innerWidth>1023)for(;e.length>0;){var t=e[0];null==t||t.destroy(!0,!0),e.splice(0,1)}else 0==e.length&&(e=n())},n=function(){var e=new Swiper(".j-promo-banners",{slidesPerView:1,loop:!0,effect:"fade",fadeEffect:{crossFade:!0},lazy:{loadPrevNext:!0},pagination:{el:".j-promo-banners-pagination",type:"bullets",dynamicBullets:!0,clickable:!0}});return e=Array.isArray(e)?e:[e]};return window.addEventListener("resize",t),t(),{destroy:function(){for(;e.length>0;){var n=e[0];n.initialized&&n.destroy(!0,!0),e.splice(0,1)}window.removeEventListener("resize",t)}}},a._updateLazyLoader=function(e){var t;null===(t=this.lazyLoader)||void 0===t||t.update(document.querySelectorAll("img[data-original], picture[data-original]").toArray(),e)},a._buildBannerRows=function(e,t,n,r){for(var a=[],o=0;o<r;o++){var s=this._buildSingleBannersRow(e,t,n+o);null!==s&&a.push(s)}return a},a._buildSingleBannersRow=function(e,t,n){var r=(n-1)*t+1+500,a=e.filter(function(e){return e.placementOptions.sort>=r&&e.placementOptions.sort<r+t}).reduce(function(e,t){return(e[t.placementOptions.sort]=e[t[t.placementOptions.sort]]||[]).push(t),e},{}),o=Object.values(a);return o.length===t?o:null},r}();wb.spa.registerViewModel(r)}();

},{"../modules/home/homeRecommendationsLoader":2}],2:[function(require,module,exports){
"use strict";var HomeVisitedRecommendationsLoader=require("./recommendationsLoader/visitedRecommendationsLoader"),HomeHitsRecommendationsLoader=require("./recommendationsLoader/hitRecommendationsLoader"),RecommedationsLoaderFactory=function(){function e(){}return e.create=function(e){switch(e.name){case"visited":return new HomeVisitedRecommendationsLoader(e);case"hits":default:return new HomeHitsRecommendationsLoader(e)}},e}();module.exports=RecommedationsLoaderFactory;

},{"./recommendationsLoader/hitRecommendationsLoader":3,"./recommendationsLoader/visitedRecommendationsLoader":6}],3:[function(require,module,exports){
"use strict";function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function asyncGeneratorStep(e,t,r,n,o,s,i){try{var a=e[s](i),u=a.value}catch(e){return void r(e)}a.done?t(u):Promise.resolve(u).then(n,o)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var s=e.apply(t,r);function i(e){asyncGeneratorStep(s,n,o,i,a,"next",e)}function a(e){asyncGeneratorStep(s,n,o,i,a,"throw",e)}i(void 0)})}}function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var HomeRecommendationsLoader=require("./recommendationsLoader"),SERVICE_URL="https://main-page.wildberries.ru/api/v2/site-recommendation",HomeHitsRecommendationsLoader=function(e){function t(t){var r;return(r=e.call(this,t)||this).adverts=[],r.advGoods=[],r.includeSoldOut=!1,r.checkedAdvCount=0,r.user=null,r}_inheritsLoose(t,e);var r=t.prototype;return r.provideGoodsAsync=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return this.nmIdsLoaded&&0==this.nms.length?{goods:[],adv:[]}:this.goods.length>=e+t&&this.advGoods.length>=r+n?{goods:this.goods.slice(e,e+t),adv:this.advGoods.slice(r,r+n)}:this.goods.length>=e+t&&this.nmIdsLoaded&&this.checkedAdvCount>=this.adverts?{goods:this.goods.slice(e,e+t),adv:[]}:this.nmIdsLoaded&&this.checkedNmCount>=this.nms.length?{goods:this.goods.slice(e,e+t),adv:[]}:this._loadGoods(e,t,r,n)},r._loadGoods=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t,r,n,o){var s,i,a,u,d,c,h,l,m,v,p,f=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.nmIdsLoaded){e.next=3;break}return e.next=3,this._loadNmIds();case 3:return this.goodsChunksCache.has(this.currentChunk)?s=this.goodsChunksCache.get(this.currentChunk):(i=this.goods.length,a=this.advGoods.length,u=this.nms.length-this.checkedNmCount,d=this.adverts.length-this.checkedAdvCount,c=Math.min(Math.ceil((i+this.chunkSize-7*a)/8),d)*(o>0),h=Math.min(u,this.chunkSize-c),l=this.nms.slice(this.checkedNmCount,this.checkedNmCount+h),m=this.adverts.slice(this.checkedAdvCount,this.checkedAdvCount+c),v=m.map(function(e){return e.id}),p=m.toMap(function(e){return e.id},function(e){return e}),this.checkedNmCount+=h,this.checkedAdvCount+=c,s=wb.xnm.getGoodsForRecommend([].concat(_toConsumableArray(l),_toConsumableArray(v)),this.includeSoldOut,!0).then(function(e){return e.forEach(function(e){if(p.has(e.cod1S)){var t,r=p.get(e.cod1S);e.isAdv=!0,e.advertId=r.advertId,e.cpm=r.cpm,e.subjectId=null!==(t=e.subjectId)&&void 0!==t?t:r.subject,e.brandId=r.brand,f.advGoods.push(e)}else f.goods.push(e)}),Promise.resolve(e)}),this.goodsChunksCache.set(this.currentChunk,s)),e.next=6,s;case 6:return this.currentChunk++,e.abrupt("return",this.provideGoodsAsync(t,r,n,o));case 8:case"end":return e.stop()}},e,this)}));return function(t,r,n,o){return e.apply(this,arguments)}}(),r._loadNmIds=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r,n,o,s,i,a,u,d,c,h,l,m,v,p,f,y;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.loadNmIdsTask){e.next=2;break}return e.abrupt("return",this.loadNmIdsTask);case 2:if(u=new this.$helper.Deferred,this.loadNmIdsTask=u.promise,d=this.$services.cartService.getItems().map(function(e){return e.cod1S}),null!=this.user){e.next=9;break}return e.next=8,"any"in Promise?Promise.any([this.$user.getUserInfo(),new Promise(function(e){return setTimeout(e,2e3)})]):this.$user.getUserInfo();case 8:this.user=e.sent;case 9:return c=(null!==(t=null===(r=this.user)||void 0===r?void 0:r.uid)&&void 0!==t?t:0).toString(),e.next=12,this.$analitic.getSplitInfo();case 12:return h=e.sent,l={UserID:c,TestID:h.splitId,TestGroup:h.title},m=this.$recentViews.get(),v={count:1e3,referrer:null!==(n=null===(o=this.$router)||void 0===o?void 0:o.referrer)&&void 0!==n?n:"",locale:wb.settings.currentLocale},(null===(s=m.nm)||void 0===s?void 0:s.length)>0&&(v.nms=m.nm.slice(0,10)),(null===(i=m.url)||void 0===i?void 0:i.length)>0&&(v.urls=m.urls),(null===(a=m.query)||void 0===a?void 0:a.length)>0&&(v.queries=m.query),d.length>0&&(v.basket_nms=d),e.prev=20,e.next=23,this.$httpClient.fetchBasicJSON(SERVICE_URL,{method:"POST",body:JSON.stringify(v),credentials:"omit",headers:l},{timeout:1e4});case 23:(null==(f=e.sent)?void 0:null===(p=f.nms)||void 0===p?void 0:p.length)>0&&(this.isPersonal=1===f.flag,this.nms=f.nms,this.adverts=null!==(y=f.adverts)&&void 0!==y?y:[]),e.next=30;break;case 27:e.prev=27,e.t0=e.catch(20),console.error(e.t0);case 30:return e.prev=30,this.nmIdsLoaded=!0,u.resolve(),e.finish(30);case 34:case"end":return e.stop()}},e,this,[[20,27,30,34]])}));return function(){return e.apply(this,arguments)}}(),t}(HomeRecommendationsLoader);module.exports=HomeHitsRecommendationsLoader;

},{"./recommendationsLoader":5}],4:[function(require,module,exports){
"use strict";function _slicedToArray(t,o){return _arrayWithHoles(t)||_iterableToArrayLimit(t,o)||_unsupportedIterableToArray(t,o)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(t,o){if(t){if("string"==typeof t)return _arrayLikeToArray(t,o);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(t,o):void 0}}function _arrayLikeToArray(t,o){(null==o||o>t.length)&&(o=t.length);for(var r=0,e=new Array(o);r<o;r++)e[r]=t[r];return e}function _iterableToArrayLimit(t,o){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var e,n,a=[],s=!0,i=!1;try{for(r=r.call(t);!(s=(e=r.next()).done)&&(a.push(e.value),!o||a.length!==o);s=!0);}catch(t){i=!0,n=t}finally{try{s||null==r.return||r.return()}finally{if(i)throw n}}return a}}function _arrayWithHoles(t){if(Array.isArray(t))return t}function _inheritsLoose(t,o){t.prototype=Object.create(o.prototype),t.prototype.constructor=t,_setPrototypeOf(t,o)}function _setPrototypeOf(t,o){return(_setPrototypeOf=Object.setPrototypeOf||function(t,o){return t.__proto__=o,t})(t,o)}var RecommendationsBlock=function(t){function o(o){var r;return(r=t.call(this)||this).id=o.id,r.goods=[],r.ordiaryGoods=[],r.advGoods=[],r.startIndex=o.startCardIndex,r.rowLength=o.rowLength,r.rowsCount=o.rowsCount,r.goodsCount=o.rowLength*o.rowsCount,r.advIndex=o.advIndex,r.advCount=o.advertCount,r.advPositions=o.advertPositions,r.advBoundaries=o.advertBoundaries,r.showTitle=o.showTitle,r.name=o.blockName,r.targetUrl=o.targetUrl,r.enableShowMoreBtn=o.enableShowMoreBtn,r.isPersonal=!1,r}_inheritsLoose(o,t);var r=o.prototype;return r.setGoods=function(t){this.ordiaryGoods=t},r.setAdvertGoods=function(t){this.advGoods=null!=t?t:[]},r.setShowMoreBtn=function(t){$.observable(this).setProperty({showBtn:this.enableShowMoreBtn&&t})},r.setIsPersonal=function(t){this.isPersonal=t},r.addGoods=function(t){$.observable(this.goods).insert(null!=t?t:[])},r.render=function(t){this.goods=this.ordiaryGoods.slice(0,this.goodsCount),this.advCount>0&&this.advGoods.length>0&&this.mergeAdvGoods(),$.link.newrecommendedgoods(t,this)},r.mergeAdvGoods=function(){for(var t=0;t<this.advGoods.length;t++){var o,r=this.advGoods[t],e=null===(o=this.advPositions)||void 0===o?void 0:o[t];if(null==e){var n,a=_slicedToArray(null!==(n=this.advBoundaries)&&void 0!==n?n:[1,this.rowLength],2),s=a[0],i=a[1];e=s+Math.floor(Math.random()*(i+1-s))}e=this.rowLength*t+(e-1),r.advPostion=e+1,this.goods[e]=r}},r.sendAdvertShowEvent=function(){var t=this;this.goods.filter(function(t){return t.isAdv}).forEach(function(o){var r=t._getAdvStatParam(o);t.$stat.sendEvent("AREMS",r)})},r.sendAdvertClickEvent=function(t){var o=$.view(t.currentTarget).data;o&&this.$stat.sendEvent("AREMC",this._getAdvStatParam(o),!0)},r.renderDynamicGoods=function(){this.setShowMoreBtn(!1);var t={id:this.id,startIndex:this.startIndex,goodsCount:this.goods.length};this.$eventBus.dispatchEvent(new CustomEvent("RecommendationBlockRequireGoods",{detail:t}))},r._getAdvStatParam=function(t){return[this.$stat.wrapParam("PARAM1",0),this.$stat.wrapParam("PARAM2",t.advertId),this.$stat.wrapParam("PARAM3",t.cod1S),this.$stat.wrapParam("PARAM4",t.advPostion),this.$stat.wrapParam("PARAM5",t.cpm),this.$stat.wrapParam("PARAM6",t.subjectId)]},o}(WbSpaModel);module.exports=RecommendationsBlock;

},{}],5:[function(require,module,exports){
"use strict";function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _iterableToArrayLimit(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],s=!0,a=!1;try{for(n=n.call(e);!(s=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);s=!0);}catch(e){a=!0,o=e}finally{try{s||null==n.return||n.return()}finally{if(a)throw o}}return i}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach(function(t){_defineProperty(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function asyncGeneratorStep(e,t,n,r,o,i,s){try{var a=e[i](s),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,o)}function _asyncToGenerator(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function s(e){asyncGeneratorStep(i,r,o,s,a,"next",e)}function a(e){asyncGeneratorStep(i,r,o,s,a,"throw",e)}s(void 0)})}}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var RecommendationsBlock=require("./recommendationsBlock"),HomeRecommendationsLoader=function(e){function t(t){var n;return(n=e.call(this)||this).dataUrl=t.dataUrl,n.name=t.name,n.sizeForDynamicGoods=t.sizeForDynamicGoods,n.sizeForStaticGood=t.sizeForStaticGood,n.targetUrl=t.targetUrl,n.title=t.title,n.analiticsCode=t.analiticsCode,n.isPersonal=!1,n.nmIdsLoaded=!1,n.nms=[],n.goods=[],n.chunkSize=100,n.currentChunk=1,n.goodsChunksCache=new Map,n.checkedNmCount=0,n.blocks=new Map,n.onGoodsRequired=n.onGoodsRequired.bind(_assertThisInitialized(n)),n}_inheritsLoose(t,e);var n=t.prototype;return n.init=function(){this._bindEvents()},n.destroy=function(){this._unbindEvents()},n.onGoodsRequired=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var n,r,o,i,s,a,c,d,u,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=null!==(n=t.detail)&&void 0!==n?n:{},o=r.id,i=r.startIndex,s=r.goodsCount,this.blocks.has(o)){e.next=3;break}return e.abrupt("return");case 3:return a=this.blocks.get(o),e.next=6,this.provideGoodsAsync(i+s,this.sizeForDynamicGoods+1);case 6:c=e.sent,d=c.goods,l=(u=void 0===d?[]:d).slice(0,this.sizeForDynamicGoods),a.addGoods(l),a.setShowMoreBtn(u.length>this.sizeForDynamicGoods),document.dispatchEvent(new CustomEvent("DynamicCarouselRendered")),this._sendViewItemListStateWba(l);case 14:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),n.addBlock=function(e){var t=_objectSpread({targetUrl:this.targetUrl,sizeForDynamicGoods:this.sizeForDynamicGoods},e);this.blocks.set(e.id,new RecommendationsBlock(t))},n.renderCarousel=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var n,r,o,i,s,a,c,d,u,l,y,h;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(o=this.blocks.get(t),i=document.getElementById(t),!(null==o||null==i||o.goods.length>0)){e.next=4;break}return e.abrupt("return");case 4:return e.next=6,Promise.all([this.provideGoodsAsync(o.startIndex,o.goodsCount,o.advIndex,o.advCount),$.views.loadTemplateAsync("newrecommendedgoods")]);case 6:s=e.sent,a=_slicedToArray(s,1),c=a[0],u=(d=null!=c?c:{}).goods,l=void 0===u?[]:u,y=d.adv,h=void 0===y?[]:y,(null==l?void 0:l.length)<1&&i.classList.add("hide"),o.setGoods(l),o.setAdvertGoods(h),o.setIsPersonal(this.isPersonal),o.setShowMoreBtn(this.goods.length+(null!==(n=null===(r=this.advGoods)||void 0===r?void 0:r.length)&&void 0!==n?n:0)>this.sizeForStaticGood),o.render(i),o.sendAdvertShowEvent(),document.dispatchEvent(new CustomEvent("DynamicCarouselRendered")),this._sendViewItemListStateWba(o.goods);case 19:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),n._sendViewItemListStateWba=function(e){var t=this,n=e.map(function(e,n){var r,o=[e.isAdv?"MAB":t.analiticsCode,"","PP","",e.isAdv?e.advertId:"",e.isAdv?e.cpm:"",""];return{id:null===(r=e.nmId)||void 0===r?void 0:r.toString(),name:e.name,brand:e.brand,price:e.priceWithCouponAndDiscount,inListIndex:n+1,listName:o.join("|"),subjectId:e.subjectId,subjectParentId:e.subjectParentId}}),r={page:1,link:window.location.origin,goods:e.length};this.$analitic.sendWbaEcomStat("view_item_list",n,r)},n._bindEvents=function(){this.$eventBus.addEventListener("RecommendationBlockRequireGoods",this.onGoodsRequired)},n._unbindEvents=function(){this.$eventBus.removeEventListener("RecommendationBlockRequireGoods",this.onGoodsRequired)},t}(WbSpaModel);module.exports=HomeRecommendationsLoader;

},{"./recommendationsBlock":4}],6:[function(require,module,exports){
"use strict";function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_unsupportedIterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return _arrayLikeToArray(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(t,e):void 0}}function _iterableToArray(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t))return _arrayLikeToArray(t)}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function asyncGeneratorStep(t,e,r,n,o,s,a){try{var i=t[s](a),u=i.value}catch(t){return void r(t)}i.done?e(u):Promise.resolve(u).then(n,o)}function _asyncToGenerator(t){return function(){var e=this,r=arguments;return new Promise(function(n,o){var s=t.apply(e,r);function a(t){asyncGeneratorStep(s,n,o,a,i,"next",t)}function i(t){asyncGeneratorStep(s,n,o,a,i,"throw",t)}a(void 0)})}}function _inheritsLoose(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var HomeRecommendationsLoader=require("./recommendationsLoader"),HomeVisitedRecommendationsLoader=function(t){function e(e){var r;return(r=t.call(this,e)||this).visitedLocally=!1,r.includeSoldOut=!0,r}_inheritsLoose(e,t);var r=e.prototype;return r.provideGoodsAsync=function(t,e){return this.nmIdsLoaded&&0==this.nms.length?{goods:[]}:this.goods.length>=t+e?{goods:this.goods.slice(t,t+e)}:this.nmIdsLoaded&&this.checkedNmCount>=this.nms.length?{goods:this.goods.slice(t,t+e),adv:[]}:this._loadGoods(t,e)},r._loadGoods=function(){var t=_asyncToGenerator(regeneratorRuntime.mark(function t(e,r){var n,o,s,a;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.nmIdsLoaded){t.next=3;break}return t.next=3,this._loadNmIds(e,r);case 3:if(!(!this.nmIdsLoaded&&this.visitedLocally&&this.nms.length<e+r)){t.next=6;break}return t.next=6,this._loadNmIds(e,r);case 6:return this.goodsChunksCache.has(this.currentChunk)?o=this.goodsChunksCache.get(this.currentChunk):(s=this.nms.slice(this.checkedNmCount,this.checkedNmCount+this.chunkSize),this.checkedNmCount+=s.length,o=wb.xnm.getGoodsForRecommend(s,this.includeSoldOut,!0),this.goodsChunksCache.set(this.currentChunk,o)),t.next=9,o;case 9:return a=t.sent,(n=this.goods).push.apply(n,_toConsumableArray(null!=a?a:[])),this.currentChunk++,t.abrupt("return",this.provideGoodsAsync(e,r));case 13:case"end":return t.stop()}},t,this)}));return function(e,r){return t.apply(this,arguments)}}(),r._loadNmIds=function(){var t=_asyncToGenerator(regeneratorRuntime.mark(function t(){var e,r,n,o,s,a,i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.visitedLocally){t.next=2;break}return t.abrupt("return",this._loadLocalNms());case 2:if(!this.loadNmIdsTask){t.next=4;break}return t.abrupt("return",this.loadNmIdsTask);case 4:return e=new this.$helper.Deferred,this.loadNmIdsTask=e.promise,t.prev=6,t.next=9,this.$httpClient.fetchBasicJSON(this.dataUrl,{method:"POST",body:null},{timeout:2e3});case 9:s=t.sent,a=(null==s?void 0:null===(r=s.value)||void 0===r?void 0:null===(n=r.nmsArr)||void 0===n?void 0:n.length)>0?s.value.nmsArr:[],i=this.nms.toHashSet(),a=a.filter(function(t){return!i.has(t)}),(o=this.nms).push.apply(o,_toConsumableArray(a)),t.next=19;break;case 16:t.prev=16,t.t0=t.catch(6),console.error(t.t0);case 19:return t.prev=19,this.nmIdsLoaded=!0,e.resolve(),t.finish(19);case 23:case"end":return t.stop()}},t,this,[[6,16,19,23]])}));return function(){return t.apply(this,arguments)}}(),r._loadLocalNms=function(){var t,e;this.visitedLocally=!0;var r=this.$recentViews.get(),n=(null===(t=r.nm)||void 0===t?void 0:t.length)>0?r.nm:[];(e=this.nms).push.apply(e,_toConsumableArray(n))},e}(HomeRecommendationsLoader);module.exports=HomeVisitedRecommendationsLoader;

},{"./recommendationsLoader":5}]},{},[1]);
